{% load static %}
<div class="container-fluid px-2 px-md-4 py-3">
    <h1>Solicitudes Recibidas</h1>
    <hr class="mb-4">
    <div class="card shadow-sm">
        <div class="card-header">
            <h5 class="mb-0">Listado de Solicitudes</h5>
        </div>
        <div class="card-body p-2 p-md-3">
            <form id="form-filtros" class="row g-2 mb-3" onsubmit="return false;">
                <div class="col-md-3">
                    <select class="form-select" name="vista">
                        <option value="">-- Vista --</option>
                        <option value="true">Sí</option>
                        <option value="false">No</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <input type="text" name="nombre" class="form-control" placeholder="Nombre">
                </div>
                <div class="col-md-3">
                    <input type="text" name="vacante" class="form-control" placeholder="Vacante">
                </div>
                <div class="col-md-3">
                    <input type="email" name="correo" class="form-control" placeholder="Correo">
                </div>
            </form>
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle">
                    <thead class="table-light text-center">
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Correo</th>
                            <th>Dirección</th>
                            <th>Teléfono</th>
                            <th>Vacante</th>
                            <th>Imagen</th>
                            <th>Currículum</th>
                            <th>Vista</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-solicitudes" class="text-center">
                        {% for app in aplicaciones %}
                        <tr>
                            <td>{{ app.id }}</td>
                            <td>
                                {% if app.imagen %}
                                    <img src="{{ app.imagen.url }}" alt="Imagen" width="50">
                                {% else %}
                                    ❌
                                {% endif %}
                            </td>
                            <td>{{ app.nombre }}</td>
                            <td>{{ app.correo }}</td>
                            <td>{{ app.direccion }}</td>
                            <td>{{ app.telefono }}</td>
                            <td>{{ app.vacante.titulo }}</td>
                            <td>
                                {% if app.curriculum %}
                                    <a href="{{ app.curriculum.url }}" target="_blank">Ver/Descargar</a>
                                {% else %}
                                    ❌
                                {% endif %}
                            </td>
                            <td>
                                {% if app.vista %}
                                     Vista
                                {% else %}
                                     No vista
                                {% endif %}
                            </td>
                            <td>
                                {% if app.vista %}
                                    <button class="btn btn-sm btn-warning" onclick="marcarVista({{ app.id }})">Marcar No Vista</button>
                                {% else %}
                                    <button class="btn btn-sm btn-success" onclick="marcarVista({{ app.id }})">Marcar Vista</button>
                                {% endif %}
                                <button class="btn btn-sm btn-danger" onclick="eliminarSolicitud({{ app.id }})">Eliminar</button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="10" class="text-center">No hay solicitudes registradas.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    const csrfToken = '{{ csrf_token }}';
</script>